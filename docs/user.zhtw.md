# ğŸš€ Repository Management API ä½¿ç”¨æ‰‹å†Š

æœ¬æ‰‹å†Šè©³ç´°èªªæ˜å¦‚ä½•é€é Repository Management API é€²è¡Œå„²å­˜åº«çš„å»ºç«‹ã€åˆªé™¤å’Œç®¡ç†ã€‚

---

## ğŸ” ç•°æ­¥æµç¨‹ (å¦‚ä½•ä½¿ç”¨)

æœ¬ API æ‰€æœ‰ä¸»è¦æ“ä½œçš†æ¡ç”¨**ç•°æ­¥ Job æ¨¡å¼**ã€‚

1.  **ç™¼é€è«‹æ±‚ï¼š** å‘Šè¨´ API ä½ è¦å»ºç«‹æˆ–åˆªé™¤ä»€éº¼è³‡æºï¼ˆä¾‹å¦‚ï¼šå„²å­˜åº«ï¼‰ã€‚
2.  **å–å¾— Job IDï¼š** API ç«‹å³å›å‚³ä¸€å€‹ç¨ç‰¹çš„ `JOB_ID`ï¼Œç‹€æ…‹ç‚º `pending` (è™•ç†ä¸­)ã€‚
3.  **æŸ¥è©¢é€²åº¦ï¼š** ä½ å¯ä»¥ä½¿ç”¨ `JOB_ID` ä¾†è¼ªè©¢ï¼ˆPollï¼‰ç‹€æ…‹ï¼Œç›´åˆ°å·¥ä½œå®Œæˆï¼ˆç‹€æ…‹ç‚º `completed` æˆ– `failed`ï¼‰ã€‚

---

## ğŸ”’ èº«åˆ†é©—è­‰

æ‰€æœ‰è«‹æ±‚**çš†éœ€**é€šéèº«åˆ†é©—è­‰ã€‚ä½ çš„ API Token å¿…é ˆåŒ…å«åœ¨ `Authorization` Header ä¸­ã€‚

| Header Key      | å€¼æ ¼å¼ (Value Format)     |
| :-------------- | :------------------------ |
| `Authorization` | `Bearer <YOUR_API_TOKEN>` |

---

## ğŸ—ï¸ API åŠŸèƒ½

### 1. å»ºç«‹å„²å­˜åº«

ç”¨æ–¼é ç½®æ–°çš„å„²å­˜åº«ä¸¦æˆäºˆä½¿ç”¨è€…å­˜å–æ¬Šã€‚

| æ–¹æ³• (Method) | ç¶²å€ (URL)      |
| :------------ | :-------------- |
| `POST`        | `/repositories` |

#### è«‹æ±‚å…§å®¹ç¯„ä¾‹

```json
{
  "Requests": [
    {
      "OrganizationName": "Department A",
      "LdapUsername": "john.doe",
      "PackageManager": "npm",
      "Shared": false,
      "AppID": "my-app-001"
    }
  ]
}
```

#### å»ºç«‹è¦å‰‡ (Request Rules for Creation)

`Shared` å’Œ `AppID` çš„çµ„åˆå®šç¾©äº†æ­£åœ¨é…ç½®çš„å„²å­˜åº«å­˜å–é¡å‹ã€‚

| è¨­å®š                 | `Shared = false` (å°ˆæ¡ˆç‰¹å®š)                      | `Shared = true` (å…±ç”¨å­˜å–)             |
| :------------------- | :----------------------------------------------- | :------------------------------------- |
| **`AppID`**          | **å¿…å¡«** (ä¾‹å¦‚ï¼š`"my-app-001"`)                  | **å¿…é ˆç‚ºç©º** (`""`)                    |
| **`PackageManager`** | **å¿…å¡«** (ä¾‹å¦‚ï¼š`"npm"`, `"maven"`)              | **å¿…å¡«** (ä¾‹å¦‚ï¼š`"npm"`, `"maven"`)    |
| **æ•ˆæœ**             | ç‚ºç‰¹å®šçš„ App (`AppID`) å»ºç«‹å°ˆå±¬çš„å„²å­˜åº«å’Œ Roleã€‚ | å»ºç«‹æˆ–åˆ†é…ä½¿ç”¨è€…ä¸€èˆ¬çš„å…±ç”¨å„²å­˜åº«è§’è‰²ã€‚ |

---

### 2. åˆªé™¤å„²å­˜åº«

ç”¨æ–¼ç§»é™¤å„²å­˜åº«å’Œæ’¤éŠ·ä½¿ç”¨è€…å­˜å–æ¬Šé™ã€‚

| æ–¹æ³• (Method) | ç¶²å€ (URL)      |
| :------------ | :-------------- |
| `DELETE`      | `/repositories` |

#### è«‹æ±‚å…§å®¹ç¯„ä¾‹ (æ¨™æº–åˆªé™¤)

```json
{
  "Requests": [
    {
      "OrganizationName": "Department A",
      "LdapUsername": "john.doe",
      "PackageManager": "npm",
      "Shared": false,
      "AppID": "my-app-001"
    }
  ]
}
```

#### è«‹æ±‚å…§å®¹ç¯„ä¾‹ (ğŸ’€ ä¸‹ç·š / å®Œæ•´ App æ¸…ç† - Offboarding)

```json
{
  "Requests": [
    {
      "OrganizationName": "Department A",
      "LdapUsername": "john.doe",
      "Shared": true,
      "AppID": "my-app-001"
    }
  ]
}
```

#### åˆªé™¤è¦å‰‡èªªæ˜ (é©—è­‰éå¸¸åš´æ ¼)

åˆªé™¤ç«¯é»æ”¯æ´å…©ç¨®ä¸åŒçš„æ¨¡å¼ã€‚

**æ¨¡å¼ Aï¼šåˆªé™¤ç‰¹å®š App çš„å„²å­˜åº«**

| æ¬„ä½ (Field)     | è¦æ±‚ (Requirement) | æ•ˆæœ (Effect)                              |
| :--------------- | :----------------- | :----------------------------------------- |
| `Shared`         | `false`            | åˆªé™¤æ­¤ç‰¹å®šå„²å­˜åº«ï¼Œä¸¦æ¸…é™¤ç›¸é—œçš„ä½¿ç”¨è€…è§’è‰²ã€‚ |
| `AppID`          | **å¿…å¡«**           |                                            |
| `PackageManager` | **å¿…å¡«**           |                                            |

**æ¨¡å¼ Bï¼šğŸ’€ ä¸‹ç·š / å®Œæ•´ App æ¸…ç†ï¼ˆOffboardingï¼‰** (å…±ç”¨å­˜å– & å®Œæ•´æ¸…ç†)

é€™æ˜¯ä¸€å€‹ã€Œä¸‹ç·šæ¨¡å¼ã€ï¼Œæœƒæ ¹æ“š `AppID` åŸ·è¡Œæ›´å»£æ³›çš„æ¸…ç†ã€‚

| æ¬„ä½ (Field)     | è¦æ±‚ (Requirement)  | æ•ˆæœ (Effect)                                                                                                      |
| :--------------- | :------------------ | :----------------------------------------------------------------------------------------------------------------- |
| `Shared`         | `true`              | åœç”¨ä½¿ç”¨è€…ï¼Œç§»é™¤å…¶å‘½åçš„ Roleï¼Œä¸¦åˆªé™¤**æ‰€æœ‰**ä»¥ `-release-<AppID>` çµå°¾çš„å„²å­˜åº«å’Œæ¬Šé™ï¼Œç„¡è«– Package Manager ç‚ºä½•ã€‚ |
| `AppID`          | **å¿…å¡«**            |                                                                                                                    |
| `PackageManager` | **å¿…é ˆç‚ºç©º** (`""`) |                                                                                                                    |

> **IQ Server å½±éŸ¿ï¼š** ä¸‹ç·šæµç¨‹ä¹Ÿæœƒç§»é™¤å°æ‡‰ `OrganizationName` çš„ IQ Server çµ„ç¹” Owner è§’è‰²ï¼Œè®“ä½¿ç”¨è€…åœ¨ç§»é™¤å„²å­˜åº«èˆ‡æ¬Šé™å¾ŒåŒæ™‚å¤±å»è©²çµ„ç¹”çš„ Owner å­˜å–æ¬Šã€‚

> **ğŸ“Œ æ³¨æ„ï¼š** API æœƒæ‹’çµ• `Shared=true` ä¸” `AppID` ç‚ºç©ºçš„ `DELETE` è«‹æ±‚ã€‚å¦‚æœæ‚¨è¦ç§»é™¤æŸä½ä½¿ç”¨è€…çš„å…±ç”¨å­˜å–æ¬Šé™ï¼Œè«‹ä½¿ç”¨**æ¨¡å¼ B**ï¼ˆå¸¶æœ‰ `AppID` çš„ä¸‹ç·šæµç¨‹ï¼‰ã€‚

---

### 3. æŸ¥è©¢é€²åº¦

ç”¨æ–¼æ“·å–ç•°æ­¥ Job çš„ç•¶å‰ç‹€æ…‹å’Œçµ±è¨ˆè³‡æ–™ã€‚

| æ–¹æ³• (Method) | ç¶²å€ (URL)       |
| :------------ | :--------------- |
| `GET`         | `/jobs/<JOB_ID>` |

#### å›å‚³ç‹€æ…‹èˆ‡æ¬„ä½å‘½åæ…£ä¾‹

| å±¬æ€§ (Property) | è©³ç´°è³‡è¨Š                                                                           |
| :-------------- | :--------------------------------------------------------------------------------- |
| `status`        | å¯èƒ½æ˜¯ï¼š`pending`ã€`processing`ã€`completed`ã€`failed`ã€‚                           |
| `action`        | æ“ä½œé¡å‹ï¼š`create` æˆ– `delete`ã€‚                                                   |
| **å¤§å°å¯«**      | **å›å‚³çš„å±¬æ€§åç¨±ä¸€å¾‹ç‚º `camelCase`** (ä¾‹å¦‚ï¼š`successfulOperations`, `createdAt`)ã€‚ |

#### å›æ‡‰ç¯„ä¾‹ (å®Œæˆæ™‚)

```json
{
  "id": "job-123",
  "status": "completed",
  "action": "create",
  "createdAt": "2025-11-20T19:00:00Z",
  "updatedAt": "2025-11-20T19:01:23Z",
  "totalRequests": 10,
  "successfulOperations": 9,
  "failedOperations": 1,
  "notProcessedOperations": 0,
  "failedRequests": [
    {
      "request": {
        "organizationName": "Department A",
        "ldapUsername": "john.doe",
        "packageManager": "npm",
        "shared": true,
        "appId": ""
      },
      "reason": "Repository already exists"
    }
  ],
  "message": "Completed with 1 failures"
}
```

---

## âš™ï¸ é—œéµé™åˆ¶èˆ‡è³‡æ–™è¦å‰‡

- **è«‹æ±‚ä¸­çš„æ¬„ä½åç¨±å€åˆ†å¤§å°å¯« (Case-Sensitive)ï¼š** è«‹ä¸€å¾‹ä½¿ç”¨æ–‡ä»¶ä¸­æŒ‡å®šçš„ç¢ºåˆ‡å¤§å°å¯« (ä¾‹å¦‚ï¼š`OrganizationName`ã€`LdapUsername`ã€`AppID`)ã€‚
- **OrganizationNameï¼š** å¿…é ˆèˆ‡ç³»çµ±é…ç½® (åœ¨ `config/organizations.json` å…§) çš„ Key **å®Œå…¨ä¸€æ¨£**ï¼ˆå€åˆ†å¤§å°å¯«ï¼‰ã€‚
- **PackageManagerï¼š** å¿…é ˆæ˜¯å—æ”¯æ´çš„é¡å‹ (ä¾‹å¦‚ `npm`ã€`maven`ã€`docker`)ï¼Œä¸¦å­˜åœ¨æ–¼ `config/packageManager.json` ä¸­ã€‚

---

## ğŸš¨ å¸¸è¦‹ API éŒ¯èª¤

| HTTP Code | éŒ¯èª¤è¨Šæ¯               | å¸¸è¦‹åŸå›                                                                             |
| :-------- | :--------------------- | :---------------------------------------------------------------------------------- |
| **401**   | `Unauthorized`         | ç¼ºå°‘æˆ–ä½¿ç”¨äº†éŒ¯èª¤çš„ `Authorization: Bearer` Tokenã€‚                                  |
| **422**   | `Unprocessable Entity` | è«‹æ±‚çš„ JSON æ ¼å¼éŒ¯èª¤ï¼Œæˆ–é•åäº†é‚è¼¯è¦å‰‡ï¼ˆä¾‹å¦‚åœ¨ä¸‹ç·šåˆªé™¤æ™‚å¸¶å…¥äº† `PackageManager`ï¼‰ã€‚ |
| **404**   | `Not Found`            | æ‰¾ä¸åˆ°æ­¤ Job IDã€‚ï¼ˆJob å„²å­˜åœ¨å…§å­˜ä¸­ï¼Œä¼ºæœå™¨é‡å•Ÿå¯èƒ½æœƒæ¸…é™¤ï¼‰ã€‚                       |
